# User specific aliases and functions
alias vim='$HOME/local/bin/vim'
alias vi=vim
alias cp='cp -i'
alias mv='mv -i'
case ${OSTYPE} in
  darwin*)
    alias ls='ls -G'
    alias rm='rmtrash'
    ;;
  linux*)
    alias ls='ls --color=always'
    mkdir -p $HOME/.Trash
    alias rm=rmFile
    ;;
esac
alias ll='clear;ls -la'
alias grep='grep --color=always'
alias vi='vim'
alias javac="javac -J-Dfile.encoding=UTF-8"
alias java="java -Dfile.encoding=UTF-8"
alias cd=cdls
alias crontab=crontabl

function rmFile {
  mv $1 $HOME/.Trash/$1.`date +%s`
}

# cd setting. do clear, cd, pwd, and ls -la
function cdls() {
	clear;
	\cd $1;
	echo -e '\e[36m'`pwd`'\e[m';
case ${OSTYPE} in
  darwin*)
    ls -la
    ;;
  linux*)
    ls -la | less -EFR;
    ;;
esac
}
# vimのlessを使うように設定
_vim_version=`vim --version | head -1 | sed 's/^.*\ \([0-9]\)\.\([0-9]\)\ .*$/\1\2/'`
_less_path='/usr/share/vim/vim'$_vim_version'/macros/less.sh'
if [ -f $_less_path ]; then
	alias lesss=$_less_path
fi

# crontab設定後crontab -lをする
function crontabl() {
  if [ $# -gt 1 ]; then
    # 複数パラメータがある場合はそのまま。
    \crontab $@
  else
    if [ "$1" != "-r" ]; then
      if [ "$1" != "-l" ]; then
        \crontab $1;
      fi
      \crontab -l;
    else
      echo "'crontab -r' is not acceptable "
    fi
  fi
}

# リモートブランチとのログの差分表示
function glr() {
  _branch=`gbn`
  git log origin/${_branch}..${_branch}
}

# リモートブランチのヘッドのハッシュと今のHEADを比較する
function git_not_pushed {
  # git管理下にいるかどうかの確認
  if [[ "`git rev-parse --is-inside-work-tree 2>/dev/null`" = "true" ]]; then
    # HEADのハッシュを取得
    _head="`git rev-parse --verify -q HEAD 2>/dev/null`"
    if [[ $? -eq 0 ]]; then
      # origin/ブランチ名のハッシュの取得
      _remote="`git rev-parse --verify -q origin/\`gbn\` 2>/dev/null`"
      if [[ $? -eq 0 ]]; then
        # 比較して違ったら、*を表示する
        if [[ ! "${_head}" = "${_remote}" ]]; then
          echo -n "*"
        fi
      fi
    fi
  fi
}

# git系のalias
alias g='git'
alias gf='g fetch'
alias gm='g merge'
alias gd='g diff'
alias ga='g add'
alias ga.='ga .'
alias gcm='g commit -m'
alias gcam='g commit --amend -m'
alias gca='g commit -a'
alias gbn='g rev-parse --abbrev-ref HEAD'
alias gp='g push origin `gbn`'
alias gl='g log --stat'
alias gs='g status'
alias gco='g checkout'
alias gpl='g pull origin `gbn`'
alias gdr='gd remotes/origin/master'
alias gr='g reset HEAD'
alias gg='g log --pretty=format:"%h %C(yellow)%ad%C(reset) | %s%C(red)%d%C(reset) %C(blue)[%an]%C(reset)" --graph --date=iso'
alias gb='g branch'
alias gbr='g branch -r'
alias gba='g branch -a'
alias gst='g stash'
alias gsts='gst save'
alias gstp='gst pop'
alias gsta='gst apply'
alias gstd='gst drop'
alias gstl='gst list'

# play用のalias
alias pr='play -DapplyEvolutions.default=true run'
alias pd='play debug -DapplyEvolutions.default=true run'
alias pt='play test'
alias pc='play compile'
alias pcc='play clean compile'
alias pcr='pcc;pr'

export EDITOR=vim svn commit
export SVN_EDITOR=vim
